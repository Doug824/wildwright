# @emnapi/wasi-threads

This package makes [wasi-threads proposal](https://github.com/WebAssembly/wasi-threads) based WASI modules work in Node.js and browser.

## Quick Start

`index.html`

```html
<script src="./node_modules/@tybys/wasm-util/dist/wasm-util.js"></script>
<script src="./node_modules/@emnapi/wasi-threads/dist/wasi-threads.js"></script>
<script src="./index.js"></script>
```

If your application will block browser main thread (for example `pthread_join`), please run it in worker instead.

```html
<script>
  // pthread_join (Atomics.wait) cannot be called in browser main thread
  new Worker('./index.js')
</script>
```

`index.js`

```js
const ENVIRONMENT_IS_NODE =
  typeof process === 'object' && process !== null &&
  typeof process.versions === 'object' && process.versions !== null &&
  typeof process.versions.node === 'string';

(function (main) {
  if (ENVIRONMENT_IS_NODE) {
    main(require)
  } else {
    if (typeof importScripts === 'function') {
      importScripts('./node_modules/@tybys/